<app-page-container containerClass="with-side-padding">
  <!-- Page Header -->
  <app-page-header 
    title="REPLAY_PARSER.TITLE" 
    description="REPLAY_PARSER.DESCRIPTION">
    <div class="mt-3">
      <p class="text-light">{{ 'REPLAY_PARSER.INFO.ABOUT_DESCRIPTION' | translate }}</p>
    </div>
  </app-page-header>

  <!-- File Upload Section -->
  <div class="file-upload-section mb-4">
    <div 
      class="file-drop-zone"
      [class.drag-over]="isDragOver"
      [class.has-file]="selectedFile"
      (dragover)="onDragOver($event)"
      (dragleave)="onDragLeave($event)"
      (drop)="onDrop($event)"
      (click)="fileInput.click()">
      
      <input 
        #fileInput 
        type="file" 
        accept=".mythrec,.mythrec.gz"
        (change)="onFileSelected($event)"
        style="display: none;">

      <div class="drop-zone-content">
        <div *ngIf="!selectedFile" class="no-file-state">
          <i class="fas fa-cloud-upload-alt mb-3"></i>
          <h4>{{ 'REPLAY_PARSER.UPLOAD.TITLE' | translate }}</h4>
          <p>{{ 'REPLAY_PARSER.UPLOAD.DESCRIPTION' | translate }}</p>
          <p class="text-small">{{ 'REPLAY_PARSER.UPLOAD.FORMATS' | translate }}</p>
        </div>

        <div *ngIf="selectedFile" class="selected-file-state">
          <i class="fas fa-file-archive mb-3 text-success"></i>
          <h5>{{ selectedFile.name }}</h5>
          <p>{{ getFileSizeString(selectedFile.size) }}</p>
          <button 
            type="button" 
            class="btn btn-warning"
            (click)="clearFile(); $event.stopPropagation()">
            <i class="fas fa-trash-alt me-2"></i>
            {{ 'REPLAY_PARSER.UPLOAD.CLEAR' | translate }}
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Parse Options -->
  <div *ngIf="selectedFile" class="parse-options-section mb-4">
    <h4 class="mb-3">
      <i class="fas fa-cogs me-2"></i>
      {{ 'REPLAY_PARSER.OPTIONS.TITLE' | translate }}
    </h4>

    <div class="row">
      <div class="col-md-6">
        <div class="form-check mb-3">
          <input 
            class="form-check-input" 
            type="checkbox" 
            id="slimMode"
            [(ngModel)]="parseOptions.slim">
          <label class="form-check-label" for="slimMode">
            {{ 'REPLAY_PARSER.OPTIONS.SLIM_MODE' | translate }}
            <small class="d-block">{{ 'REPLAY_PARSER.OPTIONS.SLIM_MODE_DESC' | translate }}</small>
          </label>
        </div>

        <div class="form-check mb-3">
          <input 
            class="form-check-input" 
            type="checkbox" 
            id="statsMode"
            [(ngModel)]="parseOptions.stats"
            [disabled]="parseOptions.slim">
          <label class="form-check-label" for="statsMode" [class.disabled-option]="parseOptions.slim">
            {{ 'REPLAY_PARSER.OPTIONS.STATS_MODE' | translate }}
            <small class="d-block">{{ 'REPLAY_PARSER.OPTIONS.STATS_MODE_DESC' | translate }}</small>
          </label>
        </div>

        <div class="form-check mb-3">
          <input 
            class="form-check-input" 
            type="checkbox" 
            id="prettyPrint"
            [(ngModel)]="parseOptions.prettyPrint">
          <label class="form-check-label" for="prettyPrint">
            {{ 'REPLAY_PARSER.OPTIONS.PRETTY_PRINT' | translate }}
            <small class="d-block">{{ 'REPLAY_PARSER.OPTIONS.PRETTY_PRINT_DESC' | translate }}</small>
          </label>
        </div>
      </div>

      <div class="col-md-6">
        <div class="form-check mb-3">
          <input 
            class="form-check-input" 
            type="checkbox" 
            id="isGzip"
            [(ngModel)]="parseOptions.isGzip">
          <label class="form-check-label" for="isGzip">
            {{ 'REPLAY_PARSER.OPTIONS.GZIP_COMPRESSION' | translate }}
            <small class="d-block">{{ 'REPLAY_PARSER.OPTIONS.GZIP_COMPRESSION_DESC' | translate }}</small>
          </label>
        </div>

        <div class="form-check mb-3">
          <input 
            class="form-check-input" 
            type="checkbox" 
            id="verbose"
            [(ngModel)]="parseOptions.verbose">
          <label class="form-check-label" for="verbose">
            {{ 'REPLAY_PARSER.OPTIONS.VERBOSE_LOGGING' | translate }}
            <small class="d-block">{{ 'REPLAY_PARSER.OPTIONS.VERBOSE_LOGGING_DESC' | translate }}</small>
          </label>
        </div>
      </div>
    </div>

    <!-- Parse Button -->
    <div class="text-center mt-4">
      <button 
        type="button" 
        class="btn btn-primary btn-lg"
        [disabled]="isProcessing"
        (click)="parseReplay()">
        <span *ngIf="isProcessing" class="spinner-border spinner-border-sm me-2" role="status"></span>
        <i *ngIf="!isProcessing" class="fas fa-play me-2"></i>
        {{ (isProcessing ? 'REPLAY_PARSER.BUTTONS.PROCESSING' : 'REPLAY_PARSER.BUTTONS.PARSE') | translate }}
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <app-loading-state 
    *ngIf="isProcessing"
    message="REPLAY_PARSER.PROCESSING_MESSAGE">
  </app-loading-state>

  <!-- Parse Results -->
  <div *ngIf="parseResult && !isProcessing" class="parse-results-section">
    <div *ngIf="parseResult.success" class="alert alert-success">
      <h5 class="alert-heading">
        <i class="fas fa-check-circle me-2"></i>
        {{ 'REPLAY_PARSER.RESULTS.SUCCESS_TITLE' | translate }}
      </h5>
      <p class="mb-3">{{ 'REPLAY_PARSER.RESULTS.SUCCESS_MESSAGE' | translate }}</p>
      
      <div class="d-flex justify-content-between align-items-center">
        <small>
          {{ 'REPLAY_PARSER.RESULTS.RESULT_SIZE' | translate }}: 
          {{ getResultSizeString() }}
        </small>
        <button 
          type="button" 
          class="btn btn-success"
          (click)="downloadResult()">
          <i class="fas fa-download me-2"></i>
          {{ 'REPLAY_PARSER.BUTTONS.DOWNLOAD' | translate }}
        </button>
      </div>
    </div>

    <div *ngIf="!parseResult.success" class="alert alert-danger">
      <h5 class="alert-heading">
        <i class="fas fa-exclamation-triangle me-2"></i>
        {{ 'REPLAY_PARSER.RESULTS.ERROR_TITLE' | translate }}
      </h5>
      <p class="mb-0">{{ parseResult.error || ('REPLAY_PARSER.RESULTS.UNKNOWN_ERROR' | translate) }}</p>
    </div>
  </div>

  <!-- Features Section -->
  <div class="features-section mt-5">
    <h4 class="text-center mb-4">
      <i class="fas fa-tools me-2 text-primary"></i>
      {{ 'REPLAY_PARSER.INFO.FEATURES_TITLE' | translate }}
    </h4>

    <div class="row g-3">
      <!-- Supported Formats Card -->
      <div class="col-lg-3 col-md-6">
        <app-glass-card cardClass="padded text-center h-100">
          <i class="fas fa-file fa-2x mb-3 text-alert"></i>
          <h4>{{ 'REPLAY_PARSER.INFO.SUPPORTED_FORMATS' | translate }}</h4>
          <p class="small mb-0">.mythrec, .mythrec.gz</p>
        </app-glass-card>
      </div>
      
      <!-- Slim Mode Card -->
      <div class="col-lg-3 col-md-6">
        <app-glass-card cardClass="padded text-center h-100">
          <i class="fas fa-compress-alt fa-2x mb-3 text-success"></i>
          <h4>Slim Mode</h4>
          <p class="small mb-0">{{ 'REPLAY_PARSER.INFO.FEATURE_SLIM' | translate }}</p>
        </app-glass-card>
      </div>
      
      <!-- Statistics Card -->
      <div class="col-lg-3 col-md-6">
        <app-glass-card cardClass="padded text-center h-100">
          <i class="fas fa-chart-bar fa-2x mb-3 text-info"></i>
          <h4>Statistics</h4>
          <p class="small mb-0">{{ 'REPLAY_PARSER.INFO.FEATURE_STATS' | translate }}</p>
        </app-glass-card>
      </div>
      
      <!-- Pretty Print Card -->
      <div class="col-lg-3 col-md-6">
        <app-glass-card cardClass="padded text-center h-100">
          <i class="fas fa-code fa-2x mb-3 text-warning"></i>
          <h4>Pretty Print</h4>
          <p class="small mb-0">{{ 'REPLAY_PARSER.INFO.FEATURE_PRETTY' | translate }}</p>
        </app-glass-card>
      </div>
    </div>
  </div>

  <!-- Empty state when no file is selected -->
  <div *ngIf="!selectedFile && !isProcessing" class="text-center mt-5">
    <app-empty-state 
      title="REPLAY_PARSER.EMPTY.TITLE" 
      description="REPLAY_PARSER.EMPTY.DESCRIPTION"
      iconClass="fas fa-file-upload">
    </app-empty-state>
  </div>
</app-page-container>